version: "{build}"

#services:
#  - mssql2014
#  - mysql

image: Visual Studio 2015

configuration:
  - Debug
  - Release

environment:
  matrix:
  - VS_VERSION: Visual Studio 14 2015
  - VS_VERSION: Visual Studio 14 2015 Win64

branches:
  only:
    - master
    - /^\d+\.\d+\.\d+$/

before_build:
  - mkdir build
  - cd build
  - cmake -G "%VS_VERSION%" -DCMAKE_BUILD_TYPE=%configuration% ..

build_script:
  - cmake --build . --config %configuration% --target check

test_script:
  - ctest --verbose

after_build:
  - ps: |
      if (($env:APPVEYOR_REPO_TAG -Match "true") -and ($env:configuration -Match "Release")) {
        cpack -G NSIS -C Release
        cpack -G ZIP -C Release
      }

artifacts:
  - path: Package/calc*.exe
    name: installer
  - path: Package/calc*.zip
    name: zipper

deploy:
  provider: GitHub
  auth_token:
    secure: "yZObcyoQ6UiUgaOwnK90Q1t9zM7IkBPonAMYPMWbmfQCZMZrCWblZ1NkDM3UlaC4TSoxzjo/XAiqA32Hon3n0JYlQIiRXu+PUc8/j+E5nuMVxJNiZQBN/v1/29xNG7n6hzjwVlbWGTj7jD6EALOPufQ2jt3ivChkp3Xo0OHgyNQBXLraWCzlrI+cbCNzAR0QcFeYMQZbEAk1T8NVTCpGTP7144LanPH/TBaWVnLOOAqf2E4ccg2berFoJXsRfVWfWTcqOE5trMSIGTSaMq7gD254wCGNh140AmsQbFXbySZpkD2sas3/KVL1Ntq+SWxuCPGjAMX2nYQt5xGP0I5sPxBZcDpd3lFI/HLdMu5/yFVFC0et6mkYtEzViOifnc0QA4qnnVC6bngFB0p1eZHTq5YDYCRpw41jWdgLGI/khkvErdHk7XRuB1q+9odyBqpS2/zT+nJ59d9wI6sUZkEA+GosOIgrzHxPqjv6nGWYq3T58sI2WPUfRj6ysw+bFQ+vLvdKZoiVFRHasPX3k1C7N1W+jiSpgAhYs+ZTxbIyMw8aVFj271RtyZwS6m+nIkLzXcEZNQzE221bakmNtPWUjEz7EglEAm4iMy425KcwiyQKDcufHpL89lb5o6oE4Q7AvvDXO0f+LPgHeq0mjM3CorYzfUyD/LE7VmN06yS4FZo="  artifact: installer,zipper
  draft: false
  prerelease: false
  on:
    configuration: Release
    appveyor_repo_tag: true